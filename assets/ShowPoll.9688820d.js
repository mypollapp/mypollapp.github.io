import{bP as O,a2 as s,aq as d,an as z,s as y,x as D,bW as M,ay as X,c9 as Y,c8 as G,ca as Z,aM as ee,bj as ae,aS as f,a5 as _,J as I,ad as m,bo as b,S as R,aY as $,a3 as Q,ac as te,a6 as j,a4 as le}from"./index.d798d0f4.js";import{h as N,c as U}from"./render.0d331bc7.js";import{f as H,h as W,Q as re,b as K}from"./QBtn.16ad5775.js";import{u as E,a as L,Q as oe}from"./use-dark.5062e3ee.js";import{Q as ne}from"./QPage.c2bf3d65.js";import{u as se}from"./ReCaptchaVuePlugin.542b8737.js";import{api as F}from"./axios.407e5795.js";var S=O({name:"QCardSection",props:{tag:{type:String,default:"div"},horizontal:Boolean},setup(e,{slots:l}){const n=s(()=>`q-card__section q-card__section--${e.horizontal===!0?"horiz row no-wrap":"vert"}`);return()=>d(e.tag,{class:n.value},N(l.default))}}),T=O({name:"QCard",props:{...E,tag:{type:String,default:"div"},square:Boolean,flat:Boolean,bordered:Boolean},setup(e,{slots:l}){const{proxy:{$q:n}}=z(),a=L(e,n),v=s(()=>"q-card"+(a.value===!0?" q-card--dark q-dark":"")+(e.bordered===!0?" q-card--bordered":"")+(e.square===!0?" q-card--square no-border-radius":"")+(e.flat===!0?" q-card--flat no-shadow":""));return()=>d(e.tag,{class:v.value},N(l.default))}});const ue={xs:2,sm:4,md:6,lg:10,xl:14};function J(e,l,n){return{transform:l===!0?`translateX(${n.lang.rtl===!0?"-":""}100%) scale3d(${-e},1,1)`:`scale3d(${e},1,1)`}}var ie=O({name:"QLinearProgress",props:{...E,...H,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(e,{slots:l}){const{proxy:n}=z(),a=L(e,n.$q),v=W(e,ue),u=s(()=>e.indeterminate===!0||e.query===!0),t=s(()=>e.reverse!==e.query),g=s(()=>({...v.value!==null?v.value:{},"--q-linear-progress-speed":`${e.animationSpeed}ms`})),k=s(()=>"q-linear-progress"+(e.color!==void 0?` text-${e.color}`:"")+(e.reverse===!0||e.query===!0?" q-linear-progress--reverse":"")+(e.rounded===!0?" rounded-borders":"")),c=s(()=>J(e.buffer!==void 0?e.buffer:1,t.value,n.$q)),q=s(()=>`with${e.instantFeedback===!0?"out":""}-transition`),C=s(()=>`q-linear-progress__track absolute-full q-linear-progress__track--${q.value} q-linear-progress__track--${a.value===!0?"dark":"light"}`+(e.trackColor!==void 0?` bg-${e.trackColor}`:"")),x=s(()=>J(u.value===!0?1:e.value,t.value,n.$q)),p=s(()=>`q-linear-progress__model absolute-full q-linear-progress__model--${q.value} q-linear-progress__model--${u.value===!0?"in":""}determinate`),B=s(()=>({width:`${e.value*100}%`})),V=s(()=>`q-linear-progress__stripe absolute-${e.reverse===!0?"right":"left"} q-linear-progress__stripe--${q.value}`);return()=>{const h=[d("div",{class:C.value,style:c.value}),d("div",{class:p.value,style:x.value})];return e.stripe===!0&&u.value===!1&&h.push(d("div",{class:V.value,style:B.value})),d("div",{class:k.value,style:g.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":e.indeterminate===!0?void 0:e.value},U(l.default,h))}}});function ce(e,l){const n=y(null),a=s(()=>e.disable===!0?null:d("span",{ref:n,class:"no-outline",tabindex:-1}));function v(u){const t=l.value;(u==null?void 0:u.qAvoidFocus)!==!0&&((u==null?void 0:u.type.indexOf("key"))===0?document.activeElement!==t&&(t==null?void 0:t.contains(document.activeElement))===!0&&t.focus():n.value!==null&&(u===void 0||(t==null?void 0:t.contains(u.target))===!0)&&n.value.focus())}return{refocusTargetEl:a,refocusTarget:v}}const de={name:String};function ve(e={}){return(l,n,a)=>{l[n](d("input",{class:"hidden"+(a||""),...e.value}))}}var fe={xs:30,sm:35,md:40,lg:50,xl:60};const me=()=>d("svg",{key:"svg",class:"q-radio__bg absolute non-selectable",viewBox:"0 0 24 24"},[d("path",{d:"M12,22a10,10 0 0 1 -10,-10a10,10 0 0 1 10,-10a10,10 0 0 1 10,10a10,10 0 0 1 -10,10m0,-22a12,12 0 0 0 -12,12a12,12 0 0 0 12,12a12,12 0 0 0 12,-12a12,12 0 0 0 -12,-12"}),d("path",{class:"q-radio__check",d:"M12,6a6,6 0 0 0 -6,6a6,6 0 0 0 6,6a6,6 0 0 0 6,-6a6,6 0 0 0 -6,-6"})]);var be=O({name:"QRadio",props:{...E,...H,...de,modelValue:{required:!0},val:{required:!0},label:String,leftLabel:Boolean,checkedIcon:String,uncheckedIcon:String,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},emits:["update:modelValue"],setup(e,{slots:l,emit:n}){const{proxy:a}=z(),v=L(e,a.$q),u=W(e,fe),t=y(null),{refocusTargetEl:g,refocusTarget:k}=ce(e,t),c=s(()=>D(e.modelValue)===D(e.val)),q=s(()=>"q-radio cursor-pointer no-outline row inline no-wrap items-center"+(e.disable===!0?" disabled":"")+(v.value===!0?" q-radio--dark":"")+(e.dense===!0?" q-radio--dense":"")+(e.leftLabel===!0?" reverse":"")),C=s(()=>{const o=e.color!==void 0&&(e.keepColor===!0||c.value===!0)?` text-${e.color}`:"";return`q-radio__inner relative-position q-radio__inner--${c.value===!0?"truthy":"falsy"}${o}`}),x=s(()=>(c.value===!0?e.checkedIcon:e.uncheckedIcon)||null),p=s(()=>e.disable===!0?-1:e.tabindex||0),B=s(()=>{const o={type:"radio"};return e.name!==void 0&&Object.assign(o,{".checked":c.value===!0,"^checked":c.value===!0?"checked":void 0,name:e.name,value:e.val}),o}),V=ve(B);function h(o){o!==void 0&&(M(o),k(o)),e.disable!==!0&&c.value!==!0&&n("update:modelValue",e.val,o)}function r(o){(o.keyCode===13||o.keyCode===32)&&M(o)}function i(o){(o.keyCode===13||o.keyCode===32)&&h(o)}Object.assign(a,{set:h});const w=me();return()=>{const o=x.value!==null?[d("div",{key:"icon",class:"q-radio__icon-container absolute-full flex flex-center no-wrap"},[d(re,{class:"q-radio__icon",name:x.value})])]:[w];e.disable!==!0&&V(o,"unshift"," q-radio__native q-ma-none q-pa-none");const P=[d("div",{class:C.value,style:u.value,"aria-hidden":"true"},o)];g.value!==null&&P.push(g.value);const A=e.label!==void 0?U(l.default,[e.label]):N(l.default);return A!==void 0&&P.push(d("div",{class:"q-radio__label q-anchor--skip"},A)),d("div",{ref:t,class:q.value,tabindex:p.value,role:"radio","aria-label":e.label,"aria-checked":c.value===!0?"true":"false","aria-disabled":e.disable===!0?"true":void 0,onClick:h,onKeydown:r,onKeyup:i},P)}}});function ge(){return X(Y)}const ye={setup(){const e=Z(),l=y(e.params.pollId||null);ge();const n=se(),a=y(!1),v=y(null),u=y(!1),t=y(null),g=y([]),k=y([]),c=y({}),{executeRecaptcha:q}=n||{};async function C(){a.value=!0;try{const r=await F.get("/api/poll");g.value=r.data}catch(r){v.value=r,console.error("Failed to fetch polls:",r)}finally{a.value=!1}}async function x(){a.value=!0;try{const r=await F.get(`/api/poll/${l.value}`);g.value=[r.data]}catch(r){v.value=r,console.error("Failed to fetch poll:",r)}finally{a.value=!1}}async function p(){a.value=!0;try{const r=await F.get(`/api/polloption/${l.value}`);k.value=r.data.map(i=>({id:i.id,label:i.label,image:i.imageURL,color:B(i.id),numberOfVotes:i.numberOfVotes})),c.value=k.value.reduce((i,w)=>(i[w.id]=w.numberOfVotes||0,i),{})}catch(r){v.value=r,console.error("Failed to fetch options:",r)}finally{a.value=!1}}function B(r){const i=["teal-6","amber-6","blue-grey-6","cyan-6"];return i[r.charCodeAt(0)%i.length]}const V=async()=>{if(!!t.value){a.value=!0;try{const r=await q("vote");(await(await fetch("https://planthegame.ch/api/polloption/submit-vote",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({PollId:l.value,OptionId:t.value,RecaptchaToken:r})})).json()).success?(c.value[t.value]=(c.value[t.value]||0)+1,u.value=!0):console.error("reCAPTCHA validation failed")}catch(r){console.error("Error submitting vote:",r)}a.value=!1}},h=r=>{const i=Object.values(c.value).reduce((w,o)=>w+o,0);return i===0?0:c.value[r]/i};return ee(async()=>{l.value?(await x(),await p()):await C()}),ae(()=>e.params.pollId,async r=>{l.value=r||null,u.value=!1,t.value=null,l.value?(await x(),await p()):await C()}),{polls:g,options:k,error:v,voteCounts:c,voted:u,selectedOption:t,submitVote:V,percentage:h,loading:a,pollId:l}}},he={key:0},_e={key:1},ke={key:2},qe={key:0},xe={class:"text-h5 text-weight-bold text-grey-2"};function we(e,l,n,a,v,u){return a.loading?(f(),_("div",he,"Loading...")):a.error?(f(),_("div",_e,"Error: "+I(a.error.message),1)):(f(),_("div",ke,[m(ne,{class:"flex flex-center page-background"},{default:b(()=>[a.pollId?(f(),Q(T,{key:1,class:"q-pa-lg shadow-10 card-background",style:{width:"600px","border-radius":"12px"}},{default:b(()=>[m(S,{class:"text-center"},{default:b(()=>{var t;return[j("div",xe,I((t=a.polls[0])==null?void 0:t.label),1)]}),_:1}),a.voted?(f(),Q(S,{key:0,class:"text-center"},{default:b(()=>[l[1]||(l[1]=j("div",{class:"text-h6 text-grey-2 q-mb-md"},"Results:",-1)),(f(!0),_(R,null,$(a.options,t=>(f(),_("div",{key:t.id,class:"q-mb-md"},[j("div",null,I(t.label)+": "+I(a.voteCounts[t.id])+" votes",1),m(ie,{value:a.percentage(t.id),color:t.color,rounded:"",class:"q-mt-sm"},null,8,["value","color"])]))),128))]),_:1})):le("",!0),m(S,{class:"row q-gutter-md justify-center"},{default:b(()=>[(f(!0),_(R,null,$(a.options,t=>(f(),Q(T,{key:t.id,class:"cursor-pointer option-card column no-wrap",style:{width:"250px","border-radius":"12px"}},{default:b(()=>[m(oe,{src:t.image,"img-style":{objectFit:"contain"},style:{height:"200px","background-color":"white"}},null,8,["src"]),m(S,{class:"text-center q-pa-md"},{default:b(()=>[m(be,{modelValue:a.selectedOption,"onUpdate:modelValue":l[0]||(l[0]=g=>a.selectedOption=g),val:t.id,label:t.label,disable:a.voted},null,8,["modelValue","val","label","disable"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),m(S,{class:"text-center"},{default:b(()=>[m(K,{color:"primary",label:"Vote",disable:!a.selectedOption||a.voted,loading:a.loading,onClick:a.submitVote},null,8,["disable","loading","onClick"])]),_:1})]),_:1})):(f(),_("div",qe,[(f(!0),_(R,null,$(a.polls,t=>(f(),Q(T,{key:t.id,class:"q-ma-md card-background shadow-5",style:{width:"400px"}},{default:b(()=>[m(S,{class:"text-h6 text-weight-bold text-grey-2"},{default:b(()=>[te(I(t.label),1)]),_:2},1024),m(S,null,{default:b(()=>[m(K,{to:`/showpoll/${t.id}`,color:"primary",label:"Vote"},null,8,["to"])]),_:2},1024)]),_:2},1024))),128))]))]),_:1})]))}var Oe=G(ye,[["render",we],["__scopeId","data-v-230c8bc3"]]);export{Oe as default};
