import{f as X,h as Y,Q as G,b as O}from"./QBtn.07b23f7e.js";import{bP as F,a2 as u,aq as v,an as A,s as b,x as J,bW as W,ay as ae,c9 as te,c8 as le,ca as re,aM as oe,aQ as ne,bj as se,aS as m,a5 as q,J as I,ad as d,bo as g,a6 as Q,S as D,aY as E,a3 as R,ac as ue,bq as ie,bM as ce,a4 as L,bt as de}from"./index.1e0f83cd.js";import{h as $,c as Z}from"./render.c9b2570a.js";import{u as K,a as U,Q as ve}from"./use-dark.eb1a5aa2.js";import{Q as fe}from"./QPage.cbb38a64.js";import{u as me}from"./ReCaptchaVuePlugin.637e48b8.js";import{api as T}from"./axios.407e5795.js";var x=F({name:"QCardSection",props:{tag:{type:String,default:"div"},horizontal:Boolean},setup(e,{slots:r}){const n=u(()=>`q-card__section q-card__section--${e.horizontal===!0?"horiz row no-wrap":"vert"}`);return()=>v(e.tag,{class:n.value},$(r.default))}}),M=F({name:"QCard",props:{...K,tag:{type:String,default:"div"},square:Boolean,flat:Boolean,bordered:Boolean},setup(e,{slots:r}){const{proxy:{$q:n}}=A(),a=U(e,n),f=u(()=>"q-card"+(a.value===!0?" q-card--dark q-dark":"")+(e.bordered===!0?" q-card--bordered":"")+(e.square===!0?" q-card--square no-border-radius":"")+(e.flat===!0?" q-card--flat no-shadow":""));return()=>v(e.tag,{class:f.value},$(r.default))}});const ge={xs:2,sm:4,md:6,lg:10,xl:14};function H(e,r,n){return{transform:r===!0?`translateX(${n.lang.rtl===!0?"-":""}100%) scale3d(${-e},1,1)`:`scale3d(${e},1,1)`}}var be=F({name:"QLinearProgress",props:{...K,...X,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(e,{slots:r}){const{proxy:n}=A(),a=U(e,n.$q),f=Y(e,ge),s=u(()=>e.indeterminate===!0||e.query===!0),t=u(()=>e.reverse!==e.query),h=u(()=>({...f.value!==null?f.value:{},"--q-linear-progress-speed":`${e.animationSpeed}ms`})),S=u(()=>"q-linear-progress"+(e.color!==void 0?` text-${e.color}`:"")+(e.reverse===!0||e.query===!0?" q-linear-progress--reverse":"")+(e.rounded===!0?" rounded-borders":"")),c=u(()=>H(e.buffer!==void 0?e.buffer:1,t.value,n.$q)),y=u(()=>`with${e.instantFeedback===!0?"out":""}-transition`),k=u(()=>`q-linear-progress__track absolute-full q-linear-progress__track--${y.value} q-linear-progress__track--${a.value===!0?"dark":"light"}`+(e.trackColor!==void 0?` bg-${e.trackColor}`:"")),w=u(()=>H(s.value===!0?1:e.value,t.value,n.$q)),B=u(()=>`q-linear-progress__model absolute-full q-linear-progress__model--${y.value} q-linear-progress__model--${s.value===!0?"in":""}determinate`),p=u(()=>({width:`${e.value*100}%`})),C=u(()=>`q-linear-progress__stripe absolute-${e.reverse===!0?"right":"left"} q-linear-progress__stripe--${y.value}`);return()=>{const _=[v("div",{class:k.value,style:c.value}),v("div",{class:B.value,style:w.value})];return e.stripe===!0&&s.value===!1&&_.push(v("div",{class:C.value,style:p.value})),v("div",{class:S.value,style:h.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":e.indeterminate===!0?void 0:e.value},Z(r.default,_))}}});function he(e,r){const n=b(null),a=u(()=>e.disable===!0?null:v("span",{ref:n,class:"no-outline",tabindex:-1}));function f(s){const t=r.value;(s==null?void 0:s.qAvoidFocus)!==!0&&((s==null?void 0:s.type.indexOf("key"))===0?document.activeElement!==t&&(t==null?void 0:t.contains(document.activeElement))===!0&&t.focus():n.value!==null&&(s===void 0||(t==null?void 0:t.contains(s.target))===!0)&&n.value.focus())}return{refocusTargetEl:a,refocusTarget:f}}const ye={name:String};function _e(e={}){return(r,n,a)=>{r[n](v("input",{class:"hidden"+(a||""),...e.value}))}}var ke={xs:30,sm:35,md:40,lg:50,xl:60};const qe=()=>v("svg",{key:"svg",class:"q-radio__bg absolute non-selectable",viewBox:"0 0 24 24"},[v("path",{d:"M12,22a10,10 0 0 1 -10,-10a10,10 0 0 1 10,-10a10,10 0 0 1 10,10a10,10 0 0 1 -10,10m0,-22a12,12 0 0 0 -12,12a12,12 0 0 0 12,12a12,12 0 0 0 12,-12a12,12 0 0 0 -12,-12"}),v("path",{class:"q-radio__check",d:"M12,6a6,6 0 0 0 -6,6a6,6 0 0 0 6,6a6,6 0 0 0 6,-6a6,6 0 0 0 -6,-6"})]);var we=F({name:"QRadio",props:{...K,...X,...ye,modelValue:{required:!0},val:{required:!0},label:String,leftLabel:Boolean,checkedIcon:String,uncheckedIcon:String,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},emits:["update:modelValue"],setup(e,{slots:r,emit:n}){const{proxy:a}=A(),f=U(e,a.$q),s=Y(e,ke),t=b(null),{refocusTargetEl:h,refocusTarget:S}=he(e,t),c=u(()=>J(e.modelValue)===J(e.val)),y=u(()=>"q-radio cursor-pointer no-outline row inline no-wrap items-center"+(e.disable===!0?" disabled":"")+(f.value===!0?" q-radio--dark":"")+(e.dense===!0?" q-radio--dense":"")+(e.leftLabel===!0?" reverse":"")),k=u(()=>{const o=e.color!==void 0&&(e.keepColor===!0||c.value===!0)?` text-${e.color}`:"";return`q-radio__inner relative-position q-radio__inner--${c.value===!0?"truthy":"falsy"}${o}`}),w=u(()=>(c.value===!0?e.checkedIcon:e.uncheckedIcon)||null),B=u(()=>e.disable===!0?-1:e.tabindex||0),p=u(()=>{const o={type:"radio"};return e.name!==void 0&&Object.assign(o,{".checked":c.value===!0,"^checked":c.value===!0?"checked":void 0,name:e.name,value:e.val}),o}),C=_e(p);function _(o){o!==void 0&&(W(o),S(o)),e.disable!==!0&&c.value!==!0&&n("update:modelValue",e.val,o)}function j(o){(o.keyCode===13||o.keyCode===32)&&W(o)}function N(o){(o.keyCode===13||o.keyCode===32)&&_(o)}Object.assign(a,{set:_});const z=qe();return()=>{const o=w.value!==null?[v("div",{key:"icon",class:"q-radio__icon-container absolute-full flex flex-center no-wrap"},[v(G,{class:"q-radio__icon",name:w.value})])]:[z];e.disable!==!0&&C(o,"unshift"," q-radio__native q-ma-none q-pa-none");const P=[v("div",{class:k.value,style:s.value,"aria-hidden":"true"},o)];h.value!==null&&P.push(h.value);const l=e.label!==void 0?Z(r.default,[e.label]):$(r.default);return l!==void 0&&P.push(v("div",{class:"q-radio__label q-anchor--skip"},l)),v("div",{ref:t,class:y.value,tabindex:B.value,role:"radio","aria-label":e.label,"aria-checked":c.value===!0?"true":"false","aria-disabled":e.disable===!0?"true":void 0,onClick:_,onKeydown:j,onKeyup:N},P)}}});function xe(){return ae(te)}const Se={setup(){const e=re(),r=b(e.params.pollId||null);xe();const n=me(),a=b(!1),f=b(null),s=b(!1),t=b(null),h=b([]),S=b([]),c=b({}),y=b(10),k=b(null),w=b(!0),{executeRecaptcha:B}=n||{};async function p(){a.value=!0;try{const l=await T.get("/api/poll");h.value=l.data}catch(l){f.value=l,console.error("Failed to fetch polls:",l)}finally{a.value=!1}}async function C(){a.value=!0;try{const l=await T.get(`/api/poll/${r.value}`);h.value=[l.data]}catch(l){f.value=l,console.error("Failed to fetch poll:",l)}finally{a.value=!1}}async function _(){a.value=!0;try{const l=await T.get(`/api/polloption/${r.value}`);S.value=l.data.map(i=>({id:i.id,label:i.label,image:i.imageURL,color:j(i.sorting),numberOfVotes:i.numberOfVotes})),c.value=S.value.reduce((i,V)=>(i[V.id]=V.numberOfVotes||0,i),{})}catch(l){f.value=l,console.error("Failed to fetch options:",l)}finally{a.value=!1}}function j(l){const i=["teal-6","amber-6","blue-grey-6","cyan-6"];return i[l%i.length]}const N=()=>{clearInterval(k.value),y.value=10,k.value=setInterval(()=>{y.value--,y.value<=0&&(clearInterval(k.value),o())},1e3)},z=async()=>{if(!!t.value){a.value=!0;try{const l=await B("vote");(await(await fetch("https://planthegame.ch/api/polloption/submit-vote",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({PollId:r.value,OptionId:t.value,RecaptchaToken:l})})).json()).success?(c.value[t.value]=(c.value[t.value]||0)+1,s.value=!0,N()):console.error("reCAPTCHA validation failed")}catch(l){console.error("Error submitting vote:",l)}a.value=!1}},o=async()=>{clearInterval(k.value),w.value=!1,setTimeout(async()=>{try{a.value=!0;const i=(await T.get("/api/poll/random")).data;if(!i){h.value=[];return}r.value=i.id,s.value=!1,t.value=null,c.value={},await C(),await _(),w.value=!0}catch(l){f.value=l,console.error("Failed to fetch random poll:",l)}finally{a.value=!1}},300)},P=l=>{const i=Object.values(c.value).reduce((V,ee)=>V+ee,0);return i===0?0:c.value[l]/i};return oe(async()=>{r.value?(await C(),await _()):await p()}),ne(()=>{clearInterval(k.value)}),se(()=>e.params.pollId,async l=>{r.value=l||null,s.value=!1,t.value=null,r.value?(await C(),await _()):await p()}),{polls:h,options:S,error:f,voteCounts:c,voted:s,selectedOption:t,submitVote:z,loadRandomPoll:o,percentage:P,loading:a,pollId:r,countdown:y,showPoll:w}}},Ce={key:0},pe={key:1},Ie={key:2},Be={key:0,class:"text-center q-pa-lg"},Pe={key:1},Ve={class:"text-h5 text-weight-bold text-grey-2"},Qe={class:"text-h6 text-grey-2 q-mb-md"};function Re(e,r,n,a,f,s){return a.loading?(m(),q("div",Ce,"Loading...")):a.error?(m(),q("div",pe,"Error: "+I(a.error.message),1)):(m(),q("div",Ie,[d(fe,{class:"flex flex-center page-background"},{default:g(()=>[!a.loading&&a.polls.length===0?(m(),q("div",Be,[d(G,{name:"info",size:"lg",class:"q-mb-sm"}),r[1]||(r[1]=Q("div",{class:"text-h6"},"No more polls available",-1)),d(O,{color:"primary",label:"Refresh",onClick:e.fetchPolls,class:"q-mt-md"},null,8,["onClick"])])):!a.pollId&&a.polls.length>0?(m(),q("div",Pe,[(m(!0),q(D,null,E(a.polls,t=>(m(),R(M,{key:t.id,class:"q-ma-md card-background shadow-5",style:{width:"400px"}},{default:g(()=>[d(x,{class:"text-h6 text-weight-bold text-grey-2"},{default:g(()=>[ue(I(t.label),1)]),_:2},1024),d(x,null,{default:g(()=>[d(O,{to:`/showpoll/${t.id}`,color:"primary",label:"Vote"},null,8,["to"])]),_:2},1024)]),_:2},1024))),128))])):a.polls.length>0?(m(),R(de,{key:2,name:"fade",mode:"out-in"},{default:g(()=>[ie(d(M,{class:"q-pa-lg shadow-10 card-background",style:{width:"600px","border-radius":"12px"}},{default:g(()=>[d(x,{class:"text-center"},{default:g(()=>[Q("div",Ve,I(a.polls[0].label),1)]),_:1}),a.voted?(m(),R(x,{key:0,class:"text-center"},{default:g(()=>[r[2]||(r[2]=Q("div",{class:"text-h6 text-grey-2 q-mb-md"},"Results:",-1)),(m(!0),q(D,null,E(a.options,t=>(m(),q("div",{key:t.id,class:"q-mb-md"},[Q("div",null,I(t.label)+": "+I(a.voteCounts[t.id])+" votes",1),d(be,{value:a.percentage(t.id),color:t.color,rounded:"",class:"q-mt-sm"},null,8,["value","color"])]))),128))]),_:1})):L("",!0),a.voted?(m(),R(x,{key:1,class:"text-center"},{default:g(()=>[Q("div",Qe," Next poll in: "+I(a.countdown)+" seconds ",1),d(O,{color:"secondary",label:"Skip Wait",onClick:a.loadRandomPoll,class:"q-mt-md"},null,8,["onClick"])]),_:1})):L("",!0),d(x,{class:"row q-gutter-md justify-center"},{default:g(()=>[(m(!0),q(D,null,E(a.options,t=>(m(),R(M,{key:t.id,class:"cursor-pointer option-card column no-wrap",style:{width:"250px","border-radius":"12px"}},{default:g(()=>[d(ve,{src:t.image,"img-style":{objectFit:"contain"},style:{height:"200px","background-color":"white"}},null,8,["src"]),d(x,{class:"text-center q-pa-md"},{default:g(()=>[d(we,{modelValue:a.selectedOption,"onUpdate:modelValue":r[0]||(r[0]=h=>a.selectedOption=h),val:t.id,label:t.label,disable:a.voted},null,8,["modelValue","val","label","disable"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),d(x,{class:"text-center"},{default:g(()=>[d(O,{color:"primary",label:"Vote",disable:!a.selectedOption||a.voted,loading:a.loading,onClick:a.submitVote},null,8,["disable","loading","onClick"])]),_:1})]),_:1},512),[[ce,a.showPoll]])]),_:1})):L("",!0)]),_:1})]))}var Ee=le(Se,[["render",Re],["__scopeId","data-v-332d641c"]]);export{Ee as default};
