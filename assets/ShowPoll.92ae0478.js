import{f as $,h as G,Q as Z,b as R}from"./QBtn.7154b1ba.js";import{bP as N,a2 as u,aq as v,an as K,s as g,x as H,bW as X,ay as le,c9 as te,c8 as oe,ca as re,aM as ne,aQ as se,bj as ue,aS as m,a5 as q,J as I,ad as d,bo as b,a6 as O,S as L,aY as M,a3 as B,ac as ie,bq as ce,bM as de,a4 as F,bt as ve}from"./index.f3930e0c.js";import{h as U,c as ee}from"./render.77ba7671.js";import{u as J,a as W,Q as fe}from"./use-dark.81dfb59b.js";import{Q as me}from"./QPage.f17986f1.js";import{u as be}from"./ReCaptchaVuePlugin.890bf005.js";import{api as j}from"./axios.407e5795.js";var C=N({name:"QCardSection",props:{tag:{type:String,default:"div"},horizontal:Boolean},setup(e,{slots:t}){const n=u(()=>`q-card__section q-card__section--${e.horizontal===!0?"horiz row no-wrap":"vert"}`);return()=>v(e.tag,{class:n.value},U(t.default))}}),A=N({name:"QCard",props:{...J,tag:{type:String,default:"div"},square:Boolean,flat:Boolean,bordered:Boolean},setup(e,{slots:t}){const{proxy:{$q:n}}=K(),a=W(e,n),f=u(()=>"q-card"+(a.value===!0?" q-card--dark q-dark":"")+(e.bordered===!0?" q-card--bordered":"")+(e.square===!0?" q-card--square no-border-radius":"")+(e.flat===!0?" q-card--flat no-shadow":""));return()=>v(e.tag,{class:f.value},U(t.default))}});const ge={xs:2,sm:4,md:6,lg:10,xl:14};function Y(e,t,n){return{transform:t===!0?`translateX(${n.lang.rtl===!0?"-":""}100%) scale3d(${-e},1,1)`:`scale3d(${e},1,1)`}}var he=N({name:"QLinearProgress",props:{...J,...$,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(e,{slots:t}){const{proxy:n}=K(),a=W(e,n.$q),f=G(e,ge),s=u(()=>e.indeterminate===!0||e.query===!0),l=u(()=>e.reverse!==e.query),h=u(()=>({...f.value!==null?f.value:{},"--q-linear-progress-speed":`${e.animationSpeed}ms`})),S=u(()=>"q-linear-progress"+(e.color!==void 0?` text-${e.color}`:"")+(e.reverse===!0||e.query===!0?" q-linear-progress--reverse":"")+(e.rounded===!0?" rounded-borders":"")),c=u(()=>Y(e.buffer!==void 0?e.buffer:1,l.value,n.$q)),_=u(()=>`with${e.instantFeedback===!0?"out":""}-transition`),k=u(()=>`q-linear-progress__track absolute-full q-linear-progress__track--${_.value} q-linear-progress__track--${a.value===!0?"dark":"light"}`+(e.trackColor!==void 0?` bg-${e.trackColor}`:"")),w=u(()=>Y(s.value===!0?1:e.value,l.value,n.$q)),V=u(()=>`q-linear-progress__model absolute-full q-linear-progress__model--${_.value} q-linear-progress__model--${s.value===!0?"in":""}determinate`),p=u(()=>({width:`${e.value*100}%`})),x=u(()=>`q-linear-progress__stripe absolute-${e.reverse===!0?"right":"left"} q-linear-progress__stripe--${_.value}`);return()=>{const y=[v("div",{class:k.value,style:c.value}),v("div",{class:V.value,style:w.value})];return e.stripe===!0&&s.value===!1&&y.push(v("div",{class:x.value,style:p.value})),v("div",{class:S.value,style:h.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":e.indeterminate===!0?void 0:e.value},ee(t.default,y))}}});function ye(e,t){const n=g(null),a=u(()=>e.disable===!0?null:v("span",{ref:n,class:"no-outline",tabindex:-1}));function f(s){const l=t.value;(s==null?void 0:s.qAvoidFocus)!==!0&&((s==null?void 0:s.type.indexOf("key"))===0?document.activeElement!==l&&(l==null?void 0:l.contains(document.activeElement))===!0&&l.focus():n.value!==null&&(s===void 0||(l==null?void 0:l.contains(s.target))===!0)&&n.value.focus())}return{refocusTargetEl:a,refocusTarget:f}}const _e={name:String};function ke(e={}){return(t,n,a)=>{t[n](v("input",{class:"hidden"+(a||""),...e.value}))}}var qe={xs:30,sm:35,md:40,lg:50,xl:60};const we=()=>v("svg",{key:"svg",class:"q-radio__bg absolute non-selectable",viewBox:"0 0 24 24"},[v("path",{d:"M12,22a10,10 0 0 1 -10,-10a10,10 0 0 1 10,-10a10,10 0 0 1 10,10a10,10 0 0 1 -10,10m0,-22a12,12 0 0 0 -12,12a12,12 0 0 0 12,12a12,12 0 0 0 12,-12a12,12 0 0 0 -12,-12"}),v("path",{class:"q-radio__check",d:"M12,6a6,6 0 0 0 -6,6a6,6 0 0 0 6,6a6,6 0 0 0 6,-6a6,6 0 0 0 -6,-6"})]);var xe=N({name:"QRadio",props:{...J,...$,..._e,modelValue:{required:!0},val:{required:!0},label:String,leftLabel:Boolean,checkedIcon:String,uncheckedIcon:String,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},emits:["update:modelValue"],setup(e,{slots:t,emit:n}){const{proxy:a}=K(),f=W(e,a.$q),s=G(e,qe),l=g(null),{refocusTargetEl:h,refocusTarget:S}=ye(e,l),c=u(()=>H(e.modelValue)===H(e.val)),_=u(()=>"q-radio cursor-pointer no-outline row inline no-wrap items-center"+(e.disable===!0?" disabled":"")+(f.value===!0?" q-radio--dark":"")+(e.dense===!0?" q-radio--dense":"")+(e.leftLabel===!0?" reverse":"")),k=u(()=>{const r=e.color!==void 0&&(e.keepColor===!0||c.value===!0)?` text-${e.color}`:"";return`q-radio__inner relative-position q-radio__inner--${c.value===!0?"truthy":"falsy"}${r}`}),w=u(()=>(c.value===!0?e.checkedIcon:e.uncheckedIcon)||null),V=u(()=>e.disable===!0?-1:e.tabindex||0),p=u(()=>{const r={type:"radio"};return e.name!==void 0&&Object.assign(r,{".checked":c.value===!0,"^checked":c.value===!0?"checked":void 0,name:e.name,value:e.val}),r}),x=ke(p);function y(r){r!==void 0&&(X(r),S(r)),e.disable!==!0&&c.value!==!0&&n("update:modelValue",e.val,r)}function z(r){(r.keyCode===13||r.keyCode===32)&&X(r)}function D(r){(r.keyCode===13||r.keyCode===32)&&y(r)}Object.assign(a,{set:y});const E=we();return()=>{const r=w.value!==null?[v("div",{key:"icon",class:"q-radio__icon-container absolute-full flex flex-center no-wrap"},[v(Z,{class:"q-radio__icon",name:w.value})])]:[E];e.disable!==!0&&x(r,"unshift"," q-radio__native q-ma-none q-pa-none");const P=[v("div",{class:k.value,style:s.value,"aria-hidden":"true"},r)];h.value!==null&&P.push(h.value);const T=e.label!==void 0?ee(t.default,[e.label]):U(t.default);return T!==void 0&&P.push(v("div",{class:"q-radio__label q-anchor--skip"},T)),v("div",{ref:l,class:_.value,tabindex:V.value,role:"radio","aria-label":e.label,"aria-checked":c.value===!0?"true":"false","aria-disabled":e.disable===!0?"true":void 0,onClick:y,onKeydown:z,onKeyup:D},P)}}});function Ce(){return le(te)}const Se={setup(){const e=re(),t=g(e.params.pollId||null);Ce();const n=be(),a=g(!1),f=g(null),s=g(!1),l=g(null),h=g([]),S=g([]),c=g({}),_=g(10),k=g(null),w=g(!0),{executeRecaptcha:V}=n||{};async function p(){a.value=!0;try{const o=await j.get("/api/poll");h.value=o.data}catch(o){f.value=o,console.error("Failed to fetch polls:",o)}finally{a.value=!1}}async function x(){a.value=!0;try{const o=await j.get(`/api/poll/${t.value}`);h.value=[o.data]}catch(o){f.value=o,console.error("Failed to fetch poll:",o)}finally{a.value=!1}}async function y(){a.value=!0;try{const o=await j.get(`/api/polloption/${t.value}`);S.value=o.data.map(i=>({id:i.id,label:i.label,image:i.imageURL,color:z(i.sorting),numberOfVotes:i.numberOfVotes})),c.value=S.value.reduce((i,Q)=>(i[Q.id]=Q.numberOfVotes||0,i),{})}catch(o){f.value=o,console.error("Failed to fetch options:",o)}finally{a.value=!1}}function z(o){const i=["teal-6","amber-6","blue-grey-6","cyan-6"];return i[o%i.length]}const D=()=>{clearInterval(k.value),_.value=10,k.value=setInterval(()=>{_.value--,_.value<=0&&(clearInterval(k.value),P())},1e3)},E=async()=>{if(!!l.value){a.value=!0;try{const o=await V("vote");(await(await fetch("https://planthegame.ch/api/polloption/submit-vote",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({PollId:t.value,OptionId:l.value,RecaptchaToken:o})})).json()).success?(c.value[l.value]=(c.value[l.value]||0)+1,s.value=!0,D()):console.error("reCAPTCHA validation failed")}catch(o){console.error("Error submitting vote:",o)}a.value=!1}},r=async()=>{await P()},P=async()=>{clearInterval(k.value),w.value=!1,setTimeout(async()=>{try{a.value=!0;const i=(await j.get(`/api/poll/random/${t.value}`)).data;if(!i){h.value=[];return}t.value=i.id,s.value=!1,l.value=null,c.value={},await x(),await y(),w.value=!0}catch(o){f.value=o,console.error("Failed to fetch random poll:",o)}finally{a.value=!1}},300)},T=o=>{const i=Object.values(c.value).reduce((Q,ae)=>Q+ae,0);return i===0?0:c.value[o]/i};return ne(async()=>{t.value?(await x(),await y()):await p()}),se(()=>{clearInterval(k.value)}),ue(()=>e.params.pollId,async o=>{t.value=o||null,s.value=!1,l.value=null,t.value?(await x(),await y()):await p()}),{polls:h,options:S,error:f,voteCounts:c,voted:s,selectedOption:l,fetchPolls:p,fetchPollById:x,fetchOptions:y,submitVote:E,skipPoll:r,loadRandomPoll:P,percentage:T,loading:a,pollId:t,countdown:_,showPoll:w}}},pe={key:0},Pe={key:1},Ie={key:2},Be={key:0,class:"text-center q-pa-lg"},Ve={key:1},Qe={class:"text-h5 text-weight-bold text-grey-2"},Re={class:"text-h6 text-grey-2 q-mb-md"};function Oe(e,t,n,a,f,s){return a.loading?(m(),q("div",pe,"Loading...")):a.error?(m(),q("div",Pe,"Error: "+I(a.error.message),1)):(m(),q("div",Ie,[d(me,{class:"flex flex-center page-background"},{default:b(()=>[!a.loading&&a.polls.length===0?(m(),q("div",Be,[d(Z,{name:"info",size:"lg",class:"q-mb-sm"}),t[1]||(t[1]=O("div",{class:"text-h6"},"No more polls available",-1)),d(R,{color:"primary",label:"Refresh",onClick:a.fetchPolls,class:"q-mt-md"},null,8,["onClick"])])):!a.pollId&&a.polls.length>0?(m(),q("div",Ve,[(m(!0),q(L,null,M(a.polls,l=>(m(),B(A,{key:l.id,class:"q-ma-md card-background shadow-5",style:{width:"400px"}},{default:b(()=>[d(C,{class:"text-h6 text-weight-bold text-grey-2"},{default:b(()=>[ie(I(l.label),1)]),_:2},1024),d(C,null,{default:b(()=>[d(R,{to:`/showpoll/${l.id}`,color:"primary",label:"Vote"},null,8,["to"])]),_:2},1024)]),_:2},1024))),128))])):a.polls.length>0?(m(),B(ve,{key:2,name:"fade",mode:"out-in"},{default:b(()=>[ce(d(A,{class:"q-pa-lg shadow-10 card-background",style:{width:"600px","border-radius":"12px"}},{default:b(()=>[d(C,{class:"text-center"},{default:b(()=>[O("div",Qe,I(a.polls[0].label),1)]),_:1}),a.voted?(m(),B(C,{key:0,class:"text-center"},{default:b(()=>[t[2]||(t[2]=O("div",{class:"text-h6 text-grey-2 q-mb-md"},"Results:",-1)),(m(!0),q(L,null,M(a.options,l=>(m(),q("div",{key:l.id,class:"q-mb-md"},[O("div",null,I(l.label)+": "+I(a.voteCounts[l.id])+" votes",1),d(he,{value:a.percentage(l.id),color:l.color,rounded:"",class:"q-mt-sm"},null,8,["value","color"])]))),128))]),_:1})):F("",!0),a.voted?(m(),B(C,{key:1,class:"text-center"},{default:b(()=>[O("div",Re," Next poll in: "+I(a.countdown)+" seconds ",1),d(R,{color:"secondary",label:"Skip Wait",onClick:a.loadRandomPoll,class:"q-mt-md"},null,8,["onClick"])]),_:1})):F("",!0),d(C,{class:"row q-gutter-md justify-center"},{default:b(()=>[(m(!0),q(L,null,M(a.options,l=>(m(),B(A,{key:l.id,class:"cursor-pointer option-card column no-wrap",style:{width:"250px","border-radius":"12px"}},{default:b(()=>[d(fe,{src:l.image,"img-style":{objectFit:"contain"},style:{height:"200px","background-color":"white"}},null,8,["src"]),d(C,{class:"text-center q-pa-md"},{default:b(()=>[d(xe,{modelValue:a.selectedOption,"onUpdate:modelValue":t[0]||(t[0]=h=>a.selectedOption=h),val:l.id,label:l.label,disable:a.voted},null,8,["modelValue","val","label","disable"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),d(C,{class:"text-center q-gutter-sm"},{default:b(()=>[d(R,{color:"primary",label:"Vote",disable:!a.selectedOption||a.voted,loading:a.loading,onClick:a.submitVote},null,8,["disable","loading","onClick"]),a.polls.length>0&&!a.polls[0].isPrivate?(m(),B(R,{key:0,color:"secondary",label:"Skip Poll",disable:a.voted,onClick:a.skipPoll,class:"q-ml-sm"},null,8,["disable","onClick"])):F("",!0)]),_:1})]),_:1},512),[[de,a.showPoll]])]),_:1})):F("",!0)]),_:1})]))}var Le=oe(Se,[["render",Oe],["__scopeId","data-v-1d31d67c"]]);export{Le as default};
